<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blood Pressure Tracker</title>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f0f0f0}
section{background:#fff;padding:15px;margin-bottom:20px;border-radius:10px}
h2{text-align:center}
input,button{padding:8px;margin:5px;width:100%;border-radius:5px;border:1px solid #ccc}
button{background:#007bff;color:#fff;border:none;cursor:pointer}
button:hover{background:#0056b3}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;text-align:center;border:1px solid #ddd}
th{background:#007bff;color:#fff}
</style>
</head>
<body>
<h2>Digital Blood Pressure Tracker</h2>

<section id="dashboard">
<h3>Dashboard</h3>
<table id="bpTable">
<tr><th>Date</th><th>User</th><th>Systolic</th><th>Diastolic</th><th>Category</th></tr>
</table>
</section>

<section id="registerSection">
<h3>Register</h3>
<form id="registerForm">
<input type="text" id="regUsername" placeholder="Username" required>
<input type="password" id="regPassword" placeholder="Password" required>
<button type="submit">Register</button>
</form>
</section>

<section id="loginSection">
<h3>Login</h3>
<form id="loginForm">
<input type="text" id="username" placeholder="Username" required>
<input type="password" id="password" placeholder="Password" required>
<button type="submit">Login</button>
</form>
</section>

<section id="recordSection" style="display:none">
<h3>Add Reading</h3>
<button id="logoutBtn">Logout</button>
<form id="bpForm">
<input type="number" id="systolic" placeholder="Systolic" required>
<input type="number" id="diastolic" placeholder="Diastolic" required>
<button type="submit">Add Reading</button>
</form>
</section>

<script>
let users = JSON.parse(localStorage.getItem("users"))||[];
let currentUser = JSON.parse(localStorage.getItem("currentUser"))||null;

function categorize(s,d){ if(s<120&&d<80)return"Normal"; if(s<130&&d<80)return"Elevated"; return"Hypertension"; }
function updateDashboard(){
 const table = document.getElementById("bpTable");
 table.innerHTML="<tr><th>Date</th><th>User</th><th>Systolic</th><th>Diastolic</th><th>Category</th></tr>";
 users.forEach(u=>u.readings?.forEach(r=>{
   table.innerHTML+=`<tr><td>${r.date}</td><td>${u.username}</td><td>${r.systolic}</td><td>${r.diastolic}</td><td>${r.category}</td></tr>`;
 }));
}
updateDashboard();

document.getElementById("registerForm").addEventListener("submit",e=>{
 e.preventDefault();
 const u=document.getElementById("regUsername").value.trim();
 const p=document.getElementById("regPassword").value.trim();
 if(users.find(x=>x.username===u)){ alert("Username exists"); return; }
 users.push({username:u,password:p,readings:[]});
 localStorage.setItem("users",JSON.stringify(users));
 alert("Registered! Now login.");
 e.target.reset();
});

document.getElementById("loginForm").addEventListener("submit",e=>{
 e.preventDefault();
 const u=document.getElementById("username").value.trim();
 const p=document.getElementById("password").value.trim();
 const user=users.find(x=>x.username===u&&x.password===p);
 if(user){
   currentUser=u;
   localStorage.setItem("currentUser",JSON.stringify(currentUser));
   document.getElementById("loginSection").style.display="none";
   document.getElementById("registerSection").style.display="none";
   document.getElementById("recordSection").style.display="block";
   alert("Login successful");
 } else alert("Invalid credentials");
});

document.getElementById("bpForm").addEventListener("submit",e=>{
 e.preventDefault();
 if(!currentUser){ alert("Login first"); return; }
 const s=parseInt(document.getElementById("systolic").value);
 const d=parseInt(document.getElementById("diastolic").value);
 const userObj=users.find(x=>x.username===currentUser);
 const reading={date:new Date().toLocaleDateString(),systolic:s,diastolic:d,category:categorize(s,d)};
 if(!userObj.readings) userObj.readings=[];
 userObj.readings.push(reading);
 localStorage.setItem("users",JSON.stringify(users));
 updateDashboard();
 e.target.reset();
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
 currentUser=null;
 localStorage.removeItem("currentUser");
 document.getElementById("recordSection").style.display="none";
 document.getElementById("loginSection").style.display="block";
 document.getElementById("registerSection").style.display="block";
 alert("Logged out");
});

if(currentUser){
 document.getElementById("loginSection").style.display="none";
 document.getElementById("registerSection").style.display="none";
 document.getElementById("recordSection").style.display="block";
}
</script>
</body>
</html>
