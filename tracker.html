<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digital Blood Pressure Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f8f9fa; }
h2 { text-align:center; margin-bottom:20px; }

.dashboard-cards { display:flex; flex-wrap:wrap; justify-content:space-around; gap:15px; margin-bottom:20px; }
.card { flex:1 1 150px; background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; }
.card h4 { margin-bottom:10px; color:#555; }
#latestSystolic,#latestDiastolic,#averageBP { font-weight:bold; font-size:1.2em; transition:color 0.5s; }

#bpChart { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.1); margin-bottom:20px; }

table { width:100%; border-collapse:collapse; margin-bottom:30px; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 4px 8px rgba(0,0,0,0.05); }
th, td { padding:12px 15px; text-align:center; border-bottom:1px solid #ddd; }
th { background:#007bff; color:#fff; }
tr:nth-child(even) { background:#f1f1f1; }

form { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.05); margin-bottom:30px; max-width:400px; margin:auto; }
input,button { padding:10px; margin:5px 0; width:100%; border-radius:8px; border:1px solid #ccc; }
button { background:#007bff; color:#fff; border:none; cursor:pointer; font-weight:bold; }
button:hover { background:#0056b3; }

#bp-advice { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.05); margin-bottom:30px; }
#bp-advice h3 { margin-top:15px; }

section { margin-bottom:20px; }
</style>
</head>
<body>
<h2>üìä Digital Blood Pressure Tracker</h2>

<!-- DASHBOARD -->
<section id="dashboard">
  <div class="dashboard-cards">
    <div class="card">
      <h4>Latest Systolic</h4>
      <p id="latestSystolic">--</p>
    </div>
    <div class="card">
      <h4>Latest Diastolic</h4>
      <p id="latestDiastolic">--</p>
    </div>
    <div class="card">
      <h4>Average BP</h4>
      <p id="averageBP">--</p>
    </div>
  </div>

  <canvas id="bpChart" width="400" height="200"></canvas>

  <h3>All Readings</h3>
  <table id="bpTable">
    <tr><th>Date</th><th>User</th><th>Systolic</th><th>Diastolic</th><th>Category</th></tr>
  </table>
</section>

<!-- DOCTORAL ADVICE -->
<section id="bp-advice">
  <h2>Doctoral Advice & Lifestyle Recommendations</h2>
  <h3>ü•ó Healthy Diet</h3>
  <ul>
    <li>DASH diet: fruits, vegetables, whole grains, low-fat dairy.</li>
    <li>Reduce sodium intake & limit processed foods.</li>
  </ul>
  <h3>üèÉ Physical Activity</h3>
  <ul>
    <li>150 min/week aerobic + 2‚Äì3 strength sessions.</li>
  </ul>
  <h3>‚öñÔ∏è Weight Management</h3>
  <ul>
    <li>Maintain healthy BMI; 5‚Äì10% weight loss reduces BP.</li>
  </ul>
  <h3>üßò Stress Management</h3>
  <ul>
    <li>Mindfulness, yoga, meditation, adequate sleep.</li>
  </ul>
  <h3>üö≠ Avoid Harmful Habits</h3>
  <ul>
    <li>Quit smoking, limit alcohol, avoid excessive caffeine.</li>
  </ul>
  <h3>üìà Regular Monitoring</h3>
  <ul>
    <li>Track BP daily or weekly; consult a doctor for abnormal readings.</li>
  </ul>
</section>

<!-- REGISTER -->
<section id="registerSection">
  <h3>Register New User</h3>
  <form id="registerForm">
    <input type="text" id="regUsername" placeholder="Username" required>
    <input type="password" id="regPassword" placeholder="Password" required>
    <button type="submit">Register</button>
  </form>
</section>

<!-- LOGIN -->
<section id="loginSection">
  <h3>Login to Record BP</h3>
  <form id="loginForm">
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>
</section>

<!-- RECORD -->
<section id="recordSection" style="display:none;">
  <h3>Add New Reading</h3>
  <button id="logoutBtn">Logout</button>
  <form id="bpForm">
    <input type="number" id="systolic" placeholder="Systolic" required>
    <input type="number" id="diastolic" placeholder="Diastolic" required>
    <button type="submit">Add Reading</button>
  </form>
</section>

<script>
document.addEventListener("DOMContentLoaded", function(){

  const bpForm = document.getElementById("bpForm");
  const bpTable = document.getElementById("bpTable");
  const latestSystolic = document.getElementById("latestSystolic");
  const latestDiastolic = document.getElementById("latestDiastolic");
  const averageBP = document.getElementById("averageBP");

  const loginForm = document.getElementById("loginForm");
  const registerForm = document.getElementById("registerForm");
  const loginSection = document.getElementById("loginSection");
  const registerSection = document.getElementById("registerSection");
  const recordSection = document.getElementById("recordSection");
  const logoutBtn = document.getElementById("logoutBtn");

  let users = JSON.parse(localStorage.getItem("users")) || [];
  let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;

  function categorize(s,d){ if(s<120&&d<80) return "Normal"; if(s<130&&d<80) return "Elevated"; return "Hypertension"; }
  function getBPColor(s,d){ if(s<120&&d<80) return "green"; if(s<130&&d<80) return "orange"; return "red"; }
  function getAllReadings(){ let all=[]; users.forEach(u=>u.readings?.forEach(r=>all.push({...r,user:u.username}))); return all; }

  let bpReadings = getAllReadings();

  const ctx = document.getElementById("bpChart").getContext("2d");
  const bpChart = new Chart(ctx,{type:"line", data:{labels:[], datasets:[]}, options:{responsive:true, plugins:{legend:{position:"top"},tooltip:{mode:'index',intersect:false}},interaction:{mode:'nearest',intersect:false},scales:{y:{beginAtZero:true}}}});

  function updateDashboard(){
    bpReadings = getAllReadings();
    bpTable.innerHTML = "<tr><th>Date</th><th>User</th><th>Systolic</th><th>Diastolic</th><th>Category</th></tr>";
    bpReadings.forEach(r=>{
      bpTable.innerHTML += `<tr><td>${r.date}</td><td>${r.user}</td><td>${r.systolic}</td><td>${r.diastolic}</td><td>${r.category}</td></tr>`;
    });

    if(bpReadings.length>0){
      const last = bpReadings[bpReadings.length-1];
      const avgS = (bpReadings.reduce((sum,r)=>sum+r.systolic,0)/bpReadings.length).toFixed(1);
      const avgD = (bpReadings.reduce((sum,r)=>sum+r.diastolic,0)/bpReadings.length).toFixed(1);

      latestSystolic.textContent = last.systolic;
      latestDiastolic.textContent = last.diastolic;
      averageBP.textContent = `${avgS}/${avgD}`;
      latestSystolic.style.color = getBPColor(last.systolic,last.diastolic);
      latestDiastolic.style.color = getBPColor(last.systolic,last.diastolic);
      averageBP.style.color = getBPColor(avgS,avgD);
    }

    bpChart.data.labels = bpReadings.map(r=>r.date+" ("+r.user+")");
    bpChart.data.datasets = [
      { label:"Systolic", data:bpReadings.map(r=>r.systolic), borderColor:"red", fill:false, pointBackgroundColor:bpReadings.map(r=>getBPColor(r.systolic,r.diastolic)), tension:0.2 },
      { label:"Diastolic", data:bpReadings.map(r=>r.diastolic), borderColor:"blue", fill:false, pointBackgroundColor:bpReadings.map(r=>getBPColor(r.systolic,r.diastolic)), tension:0.2 }
    ];
    bpChart.update();
  }

  updateDashboard();

  // REGISTER
  registerForm.addEventListener("submit", e=>{
    e.preventDefault();
    const u = document.getElementById("regUsername").value.trim();
    const p = document.getElementById("regPassword").value.trim();
    if(users.find(user=>user.username===u)){ alert("Username exists"); return; }
    users.push({username:u,password:p,readings:[]});
    localStorage.setItem("users", JSON.stringify(users));
    alert("Registration successful! You can now login.");
    registerForm.reset();
  });

  // LOGIN
  loginForm.addEventListener("submit", e=>{
    e.preventDefault();
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    const user = users.find(user=>user.username===u && user.password===p);
    if(user){
      currentUser = user.username;
      localStorage.setItem("currentUser", JSON.stringify(currentUser));
      loginSection.style.display = "none";
      registerSection.style.display = "none";
      recordSection.style.display = "block";
      alert("Login successful! You can now add readings.");
    } else alert("Invalid credentials");
  });

  // ADD READING
  bpForm.addEventListener("submit", e=>{
    e.preventDefault();
    if(!currentUser){ alert("Login required"); return; }
    const s = parseInt(document.getElementById("systolic").value);
    const d = parseInt(document.getElementById("diastolic").value);
    const userObj = users.find(u=>u.username===currentUser);
    const reading = {date:new Date().toLocaleDateString(), systolic:s, diastolic:d, category:categorize(s,d)};
    userObj.readings.push(reading);
    localStorage.setItem("users", JSON.stringify(users));
    updateDashboard();
    bpForm.reset();
  });

  // LOGOUT
  logoutBtn.addEventListener("click", ()=>{
    currentUser = null;
    localStorage.removeItem("currentUser");
    recordSection.style.display = "none";
    loginSection.style.display = "block";
    registerSection.style.display = "block";
    alert("Logged out. Dashboard remains visible to all.");
  });

  // AUTO LOGIN
  if(currentUser){
    loginSection.style.display = "none";
    registerSection.style.display = "none";
    recordSection.style.display = "block";
  }

});
</script>

</body>
</html>
